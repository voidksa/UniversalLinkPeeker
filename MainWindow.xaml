<Window x:Class="UniversalLinkPeeker.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="Link Peeker" Height="400" Width="500"
        WindowStyle="None" ResizeMode="NoResize"
        ShowInTaskbar="False" Topmost="True"
        ShowActivated="False"
        AllowsTransparency="True" Background="Transparent"
        Visibility="Hidden">

    <Window.Resources>
    </Window.Resources>

    <Border Name="MainBorder" CornerRadius="12" BorderThickness="1" Background="{DynamicResource WindowBackgroundBrush}" BorderBrush="{DynamicResource WindowBorderBrush}" ClipToBounds="True">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="5" Direction="270" Opacity="0.2"/>
        </Border.Effect>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Name="HeaderBorder" Grid.Row="0" CornerRadius="12,12,0,0" Padding="12,8" Background="{DynamicResource HeaderBackgroundBrush}" BorderBrush="{DynamicResource WindowBorderBrush}" BorderThickness="0">
                <Grid>
                    <TextBlock Name="UrlTitle" Text="Loading..." VerticalAlignment="Center" FontSize="12" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" Foreground="{DynamicResource PrimaryTextBrush}"/>
                </Grid>
            </Border>

            <!-- Content -->
            <Grid Grid.Row="1">
                <!-- Loading State -->
                <Grid Name="LoadingGrid" Panel.ZIndex="1" Background="{DynamicResource WindowBackgroundBrush}">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                        <ProgressBar IsIndeterminate="True" Width="150" Height="4" BorderThickness="0" Background="{DynamicResource WindowBorderBrush}" Foreground="#1A73E8"/>
                        <TextBlock Name="LoadingText" Text="Loading Preview..." Margin="0,12,0,0" HorizontalAlignment="Center" FontSize="12" Foreground="{DynamicResource PrimaryTextBrush}"/>
                    </StackPanel>
                </Grid>

                <!-- WebView -->
                <!-- Visibility Hidden initially to hide white flash -->
                <wv2:WebView2 Name="webView" Visibility="Hidden" DefaultBackgroundColor="Transparent"/>
            </Grid>

            <!-- Copy Notification Popup (overcomes WebView2 airspace) -->
            <Popup Name="CopyPopup" Placement="Bottom" StaysOpen="True" AllowsTransparency="True" PlacementTarget="{Binding ElementName=MainBorder}">
                <Border Name="CopyPopupBorder" Background="{DynamicResource WindowBackgroundBrush}" BorderBrush="{DynamicResource WindowBorderBrush}" BorderThickness="1" CornerRadius="8" Padding="16,8" >
                    <TextBlock Name="NotificationText" Text="Copied!" Foreground="{DynamicResource PrimaryTextBrush}" FontWeight="SemiBold" FontSize="14"/>
                </Border>
            </Popup>
        </Grid>
    </Border>
</Window>
